@page "/"
@inject IJSRuntime JSRuntime
@inject Client.Data.IMap Map
@using Client.Models

<div id='map'></div>
<div class="map-overlay">
    <div class="map-overlay-inner">
        <button @onclick="AddMarker">@buttonText</button>
        @if (buttonText.Equals("Save & Add Place"))
        { 
    <div>
        <EditForm Model="@placeData" OnValidSubmit="@AddMarker">
            <DataAnnotationsValidator />
            <ValidationSummary />
            Title: <br />
            <InputText id="title" @bind-Value="placeData.Title" />
            Description: <br />
            <InputText id="description" @bind-Value="placeData.Description" />

        </EditForm>

    </div>
            
            
            @*<fieldset @bind-Value="PlaceTitle">
            <label for="title">Title:</label>
            <input type="text"
                   id="title"
                   name="title" />
        </fieldset>
        <fieldset>
            <label for="description">Description:</label>
            <input type="text"
                   id="description"
                   name="description" />
        </fieldset>*@
        }

    </div>
</div>

@code{
    private PlaceData placeData = new PlaceData(); 
    private string buttonText = "Add Place";

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
            await Map.InitMapAsync();
    }

    private async Task AddMarker()
    {
        if (buttonText.Equals("Add Place"))
        {
            buttonText = "Save & Add Place";
        }
        else
        {
            await Map.CreatePlace(placeData);
            placeData.Reset();
            buttonText = "Add Place";
        }
        Map.ChangeAddingMarkerMode();
    }
}
